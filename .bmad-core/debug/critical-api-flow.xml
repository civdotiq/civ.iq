<?xml version="1.0" encoding="UTF-8"?>
<debug-context>
<!-- Critical files for Representative API debugging -->
<file path="src/app/(civic)/representative/[bioguideId]/page.tsx">
/**
 * Copyright (c) 2019-2025 Mark Sandford
 * Licensed under the MIT License. See LICENSE and NOTICE files.
 */

import { notFound } from 'next/navigation';
import { RepresentativeClient } from './components/RepresentativeClient';
import { ErrorBoundary } from '@/components/common/ErrorBoundary';
import { ChunkLoadErrorBoundary } from '@/components/common/ChunkLoadErrorBoundary';
import { extractTransparencyMetadata } from '@/components/ui/DataTransparency';
import { SiteHeader } from '@/components/layout/SiteHeader';
import Link from 'next/link';
// Note: Using console directly in Server Components to avoid React rendering issues
// import { logger } from '@/lib/logging/logger-client';
import { getEnhancedRepresentative } from '@/features/representatives/services/congress.service';

export const dynamic = 'force-dynamic';

interface RepresentativeDetails {
  bioguideId: string;
  name: string;
  firstName: string;
  lastName: string;
  party: string;
  state: string;
  district?: string;
  chamber: 'House' | 'Senate';
  title: string;
  phone?: string;
  email?: string;
  website?: string;
  imageUrl?: string;
  terms: Array&lt;{
    congress: string;
    startYear: string;
    endYear: string;
  }&gt;;
  committees?: Array&lt;{
    name: string;
    role?: string;
    thomas_id?: string;
    id?: string;
  }&gt;;
  fullName?: {
    first: string;
    middle?: string;
    last: string;
    suffix?: string;
    nickname?: string;
    official?: string;
  };
  bio?: {
    birthday?: string;
    gender?: 'M' | 'F';
    religion?: string;
  };
  currentTerm?: {
    start: string;
    end: string;
    office?: string;
    phone?: string;
    address?: string;
    website?: string;
    contactForm?: string;
    rssUrl?: string;
    stateRank?: 'junior' | 'senior';
    class?: number;
  };
  socialMedia?: {
    twitter?: string;
    facebook?: string;
    youtube?: string;
    instagram?: string;
    mastodon?: string;
  };
}

// Server-side data fetching with direct service import (no HTTP networking)
async function getRepresentativeData(bioguideId: string): Promise&lt;RepresentativeDetails&gt; {
  try {
    if (!bioguideId || typeof bioguideId !== 'string') {
      const _error = 'Invalid bioguideId provided';
      if (process.env.NODE_ENV === 'development') {
        // Server component error handling - no console.error
      }
      notFound();
    }

    if (process.env.NODE_ENV === 'development') {
      // Server component - fetching representative data
    }

    // Direct service call - no HTTP networking during SSR
    const enhancedData = await getEnhancedRepresentative(bioguideId.toUpperCase());

    if (!enhancedData) {
      if (process.env.NODE_ENV === 'development') {
        // Representative not found in congress-legislators data
      }
      notFound();
    }

    if (process.env.NODE_ENV === 'development') {
      // Representative data fetched successfully
    }

    return enhancedData;
  } catch {
    if (process.env.NODE_ENV === 'development') {
      // Representative data fetch failed - return not found
    }
    notFound();
  }
}

// Main Server Component - renders immediately with SSR data
export default async function RepresentativeProfilePage({
  params,
}: {
  params: Promise&lt;{ bioguideId: string }&gt;;
}) {
  let bioguideId: string;

  try {
    const resolvedParams = await params;
    bioguideId = resolvedParams.bioguideId;

    if (!bioguideId || typeof bioguideId !== 'string') {
      notFound();
    }
  } catch {
    notFound();
  }

  // Server-side data fetching - this runs on the server and streams HTML
  const representative = await getRepresentativeData(bioguideId);

  // Handle fetch errors gracefully - representative data is required
  if (!representative) {
    notFound();
  }

  // Server-side data fetching for initial load performance
  // Construct absolute URL for server-side fetch (Node.js requires absolute URLs)
  // Use localhost for development, but this will be replaced with proper base URL in production
  const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';
  const billsUrl = `${baseUrl}/api/representative/${bioguideId}/bills`;
  const votesUrl = `${baseUrl}/api/representative/${bioguideId}/votes`;

  // Fetch bills data server-side
  let billsData: unknown[] = [];
  let billsResponseData: unknown = null;
  try {
    const billsResponse = await fetch(billsUrl, {
      headers: {
        Accept: 'application/json',
      },
    });

    if (billsResponse.ok) {
      billsResponseData = await billsResponse.json();
      const responseObj = billsResponseData as Record&lt;string, unknown&gt;;

      // Extract metadata for transparency
      const _billsMetadata = extractTransparencyMetadata(responseObj);

      billsData = Array.isArray(responseObj?.sponsoredLegislation)
        ? responseObj.sponsoredLegislation
        : Array.isArray(responseObj?.bills)
          ? responseObj.bills
          : Array.isArray(billsResponseData)
            ? billsResponseData
            : [];

      // Server component bills data extracted successfully
    } else {
      // Bills fetch failed with HTTP error
    }
  } catch {
    // Bills fetch error occurred
    billsData = [];
  }

  // Fetch votes data server-side
  let votingData: unknown[] = [];
  let votesResponseData: unknown = null;
  try {
    const votesResponse = await fetch(votesUrl, {
      headers: {
        Accept: 'application/json',
      },
    });

    if (votesResponse.ok) {
      votesResponseData = await votesResponse.json();
      const votesObj = votesResponseData as Record&lt;string, unknown&gt;;

      // Extract metadata for transparency
      const _votesMetadata = extractTransparencyMetadata(votesObj);

      votingData = Array.isArray(votesObj?.votes) ? votesObj.votes : [];

      // Server component votes data extracted successfully
    } else {
      // Votes fetch failed with HTTP error
    }
  } catch {
    // Votes fetch error occurred
    votingData = [];
  }
  const financeData: Record&lt;string, unknown&gt; = {};
  const newsData: unknown[] = [];
  const _partyAlignmentData: Record&lt;string, unknown&gt; = {};
  const partialErrors: Record&lt;string, string&gt; = {};

  // Validate essential representative data - be more lenient
  if (
    !representative ||
    (!representative.name &amp;&amp; !representative.firstName &amp;&amp; !representative.lastName)
  ) {
    notFound();
  }

  // Set display name if needed
  if (!representative.name &amp;&amp; representative.firstName &amp;&amp; representative.lastName) {
    representative.name = `${representative.firstName} ${representative.lastName}`;
  }

  // Debug logging removed - was causing RSC serialization issues

  return (
    &lt;&gt;
      &lt;SiteHeader /&gt;

      &lt;div className="container mx-auto px-4 py-6"&gt;
        &lt;Link href="/" className="inline-flex items-center text-blue-600 hover:text-blue-800 mb-4"&gt;
          ‚Üê Back to Search
        &lt;/Link&gt;
      &lt;/div&gt;

      &lt;ChunkLoadErrorBoundary&gt;
        &lt;ErrorBoundary&gt;
          &lt;RepresentativeClient
            representative={representative}
            serverData={{
              bills: billsData,
              votes: votingData,
              finance: financeData,
              news: newsData,
            }}
            partialErrors={partialErrors}
          /&gt;
        &lt;/ErrorBoundary&gt;
      &lt;/ChunkLoadErrorBoundary&gt;
    &lt;/&gt;
  );
}

export async function generateMetadata({ params }: { params: Promise&lt;{ bioguideId: string }&gt; }) {
  const { bioguideId } = await params;

  return {
    title: `Representative ${bioguideId} | CIV.IQ`,
    description: `View detailed information about federal representative ${bioguideId}`,
  };
}

</file>
<file path="src/app/(civic)/representative/[bioguideId]/tabs/VotingTab.tsx">
/**
 * Copyright (c) 2019-2025 Mark Sandford
 * Licensed under the MIT License. See LICENSE and NOTICE files.
 */

'use client';

import React from 'react';

interface Vote {
  id: string;
  date: string;
  bill?: {
    number: string;
    title: string;
    url?: string;
  };
  question?: string;
  description: string;
  position: 'Yea' | 'Nay' | 'Present' | 'Not Voting';
  result: 'Passed' | 'Failed' | 'Agreed to' | 'Disagreed to';
  chamber: 'House' | 'Senate';
  category?: string;
}

interface VotingTabProps {
  votes: Vote[];
  metadata?: unknown;
  loading?: boolean;
}

export function VotingTab({ votes = [] }: VotingTabProps) {
  // Calculate voting statistics
  const yesVotes = votes.filter(vote =&gt; vote.position === 'Yea').length;
  const nayVotes = votes.filter(vote =&gt; vote.position === 'Nay').length;
  const presentVotes = votes.filter(vote =&gt; vote.position === 'Present').length;
  const notVotingVotes = votes.filter(vote =&gt; vote.position === 'Not Voting').length;
  const totalVotes = votes.length;
  const keyVotes = votes.filter(vote =&gt; vote.category === 'key').length;

  return (
    &lt;&gt;
      &lt;h2 className="text-lg font-semibold mb-4"&gt;Interactive Voting Analysis&lt;/h2&gt;

      {/* Metrics */}
      &lt;div className="grid grid-cols-5 gap-4 mb-8"&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold"&gt;{totalVotes}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Total Votes&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold text-green-600"&gt;{yesVotes}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Yes&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold text-red-600"&gt;{nayVotes}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Nay&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold"&gt;{presentVotes}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Present&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold"&gt;{keyVotes}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Key Votes&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {/* Position Bars */}
      &lt;h3 className="font-medium mb-3"&gt;Position Distribution&lt;/h3&gt;
      &lt;div className="space-y-2 mb-8"&gt;
        &lt;div className="flex items-center gap-3"&gt;
          &lt;span className="w-20 text-sm"&gt;Yes&lt;/span&gt;
          &lt;div className="flex-1 bg-gray-200 rounded h-6"&gt;
            &lt;div
              className="bg-green-500 h-6 rounded"
              style={{
                width: totalVotes &gt; 0 ? `${(yesVotes / totalVotes) * 100}%` : '0%',
              }}
            &gt;&lt;/div&gt;
          &lt;/div&gt;
          &lt;span className="text-sm"&gt;
            {totalVotes &gt; 0 ? Math.round((yesVotes / totalVotes) * 100) : 0}%
          &lt;/span&gt;
        &lt;/div&gt;
        &lt;div className="flex items-center gap-3"&gt;
          &lt;span className="w-20 text-sm"&gt;Nay&lt;/span&gt;
          &lt;div className="flex-1 bg-gray-200 rounded h-6"&gt;
            &lt;div
              className="bg-red-500 h-6 rounded"
              style={{
                width: totalVotes &gt; 0 ? `${(nayVotes / totalVotes) * 100}%` : '0%',
              }}
            &gt;&lt;/div&gt;
          &lt;/div&gt;
          &lt;span className="text-sm"&gt;
            {totalVotes &gt; 0 ? Math.round((nayVotes / totalVotes) * 100) : 0}%
          &lt;/span&gt;
        &lt;/div&gt;
        {presentVotes &gt; 0 &amp;&amp; (
          &lt;div className="flex items-center gap-3"&gt;
            &lt;span className="w-20 text-sm"&gt;Present&lt;/span&gt;
            &lt;div className="flex-1 bg-gray-200 rounded h-6"&gt;
              &lt;div
                className="bg-yellow-500 h-6 rounded"
                style={{
                  width: totalVotes &gt; 0 ? `${(presentVotes / totalVotes) * 100}%` : '0%',
                }}
              &gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;span className="text-sm"&gt;
              {totalVotes &gt; 0 ? Math.round((presentVotes / totalVotes) * 100) : 0}%
            &lt;/span&gt;
          &lt;/div&gt;
        )}
        {notVotingVotes &gt; 0 &amp;&amp; (
          &lt;div className="flex items-center gap-3"&gt;
            &lt;span className="w-20 text-sm"&gt;Not Voting&lt;/span&gt;
            &lt;div className="flex-1 bg-gray-200 rounded h-6"&gt;
              &lt;div
                className="bg-gray-500 h-6 rounded"
                style={{
                  width: totalVotes &gt; 0 ? `${(notVotingVotes / totalVotes) * 100}%` : '0%',
                }}
              &gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;span className="text-sm"&gt;
              {totalVotes &gt; 0 ? Math.round((notVotingVotes / totalVotes) * 100) : 0}%
            &lt;/span&gt;
          &lt;/div&gt;
        )}
      &lt;/div&gt;

      {/* Recent Votes */}
      &lt;h3 className="font-medium mb-3"&gt;Recent Voting Record&lt;/h3&gt;
      {votes.length === 0 ? (
        &lt;p className="text-gray-500 text-center py-8"&gt;No voting data available&lt;/p&gt;
      ) : (
        &lt;div className="overflow-x-auto"&gt;
          &lt;table className="w-full"&gt;
            &lt;thead&gt;
              &lt;tr className="border-b"&gt;
                &lt;th className="text-left py-2"&gt;Bill&lt;/th&gt;
                &lt;th className="text-left py-2"&gt;Description&lt;/th&gt;
                &lt;th className="text-left py-2"&gt;Date&lt;/th&gt;
                &lt;th className="text-right py-2"&gt;Position&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              {votes.slice(0, 10).map(vote =&gt; (
                &lt;tr key={vote.id} className="border-b"&gt;
                  &lt;td className="py-3"&gt;
                    {vote.bill?.number ? (
                      vote.bill.url ? (
                        &lt;a
                          href={vote.bill.url}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-blue-600 hover:underline"
                        &gt;
                          {vote.bill.number}
                        &lt;/a&gt;
                      ) : (
                        vote.bill.number
                      )
                    ) : (
                      'Voice Vote'
                    )}
                  &lt;/td&gt;
                  &lt;td className="py-3 text-sm text-gray-600"&gt;
                    {vote.bill?.title || vote.question || vote.description}
                  &lt;/td&gt;
                  &lt;td className="py-3 text-sm text-gray-500"&gt;
                    {new Date(vote.date).toLocaleDateString()}
                  &lt;/td&gt;
                  &lt;td className="text-right py-3"&gt;
                    &lt;span
                      className={`px-2 py-1 rounded text-sm ${
                        vote.position === 'Yea'
                          ? 'bg-green-100 text-green-700'
                          : vote.position === 'Nay'
                            ? 'bg-red-100 text-red-700'
                            : vote.position === 'Present'
                              ? 'bg-yellow-100 text-yellow-700'
                              : 'bg-gray-100 text-gray-700'
                      }`}
                    &gt;
                      {vote.position}
                    &lt;/span&gt;
                  &lt;/td&gt;
                &lt;/tr&gt;
              ))}
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      )}
    &lt;/&gt;
  );
}

</file>
<file path="src/app/(civic)/representative/[bioguideId]/tabs/BillsTab.tsx">
/**
 * Copyright (c) 2019-2025 Mark Sandford
 * Licensed under the MIT License. See LICENSE and NOTICE files.
 */

'use client';

import React from 'react';

interface Bill {
  id: string;
  number: string;
  title: string;
  introducedDate: string;
  status: string;
  lastAction: string;
  congress: number;
  type: string;
  policyArea: string;
  url?: string;
  committee?: string;
  progress?: number;
}

interface BillsTabProps {
  bills: Bill[];
  metadata?: unknown;
  loading?: boolean;
}

export function BillsTab({ bills = [] }: BillsTabProps) {
  // Calculate bill statistics
  const totalBills = bills.length;
  const enactedBills = bills.filter(bill =&gt; bill.status.toLowerCase().includes('enacted')).length;
  const avgCosponsors = 0; // This would come from actual data
  const totalSupport = 0; // This would come from actual data

  return (
    &lt;&gt;
      &lt;h2 className="text-lg font-semibold mb-4"&gt;Legislative Tracker&lt;/h2&gt;

      &lt;div className="grid grid-cols-4 gap-4 mb-8"&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold text-blue-600"&gt;{totalBills}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Bills Sponsored&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold text-green-600"&gt;{enactedBills}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Enacted&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold text-yellow-600"&gt;{avgCosponsors}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Avg Cosponsors&lt;/div&gt;
        &lt;/div&gt;
        &lt;div className="text-center"&gt;
          &lt;div className="text-3xl font-bold text-purple-600"&gt;{totalSupport}&lt;/div&gt;
          &lt;div className="text-sm text-gray-500"&gt;Total Support&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {bills.length === 0 ? (
        &lt;p className="text-gray-500 text-center py-8"&gt;No bills data available&lt;/p&gt;
      ) : (
        &lt;div className="space-y-4"&gt;
          {bills.slice(0, 10).map(bill =&gt; (
            &lt;div key={bill.id} className="border rounded-lg p-4"&gt;
              &lt;h3 className="font-medium"&gt;
                {bill.url ? (
                  &lt;a
                    href={bill.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-blue-600 hover:underline"
                  &gt;
                    {bill.number}: {bill.title}
                  &lt;/a&gt;
                ) : (
                  `${bill.number}: ${bill.title}`
                )}
              &lt;/h3&gt;
              &lt;p className="text-sm text-gray-500 mt-1"&gt;
                Introduced: {new Date(bill.introducedDate).toLocaleDateString()}
              &lt;/p&gt;
              &lt;p className="text-sm text-gray-600 mt-1"&gt;{bill.lastAction}&lt;/p&gt;
              &lt;div className="flex gap-2 mt-2"&gt;
                &lt;span className="text-xs bg-gray-100 px-2 py-1 rounded"&gt;
                  {bill.committee || 'Committee: Unknown'}
                &lt;/span&gt;
                &lt;span className="text-xs bg-blue-100 px-2 py-1 rounded"&gt;{bill.type}&lt;/span&gt;
                {bill.policyArea &amp;&amp; (
                  &lt;span className="text-xs bg-green-100 px-2 py-1 rounded"&gt;{bill.policyArea}&lt;/span&gt;
                )}
                &lt;span className="text-xs bg-yellow-100 px-2 py-1 rounded"&gt;
                  {bill.status || 'Status: Unknown'}
                &lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          ))}
        &lt;/div&gt;
      )}
    &lt;/&gt;
  );
}

</file>
<file path="src/app/(civic)/representative/[bioguideId]/components/RepresentativeClient.tsx">
/**
 * Copyright (c) 2019-2025 Mark Sandford
 * Licensed under the MIT License. See LICENSE and NOTICE files.
 */

'use client';

import React, { useState } from 'react';
import dynamic from 'next/dynamic';
import { DataTransparencyPanel } from '@/components/ui/DataTransparency';
import { EnhancedRepresentative } from '@/types/representative';
import { EnhancedHeader } from './EnhancedHeader';
import { KeyStatsBar } from './KeyStatsBar';
import { TabNavigation, profileTabs } from './TabNavigation';
import { ProfileOverview } from './ProfileOverview';
import { DistrictSidebar } from './DistrictSidebar';
import { ContactInfoTab } from './ContactInfoTab';

// Dynamic imports with proper error boundaries for tab components
const VotingTab = dynamic(
  () =&gt; import('../tabs/VotingTab').then(mod =&gt; ({ default: mod.VotingTab })),
  {
    loading: () =&gt; &lt;div className="animate-pulse bg-gray-200 h-64 rounded"&gt;&lt;/div&gt;,
    ssr: false,
  }
);

const BillsTab = dynamic(
  () =&gt; import('../tabs/BillsTab').then(mod =&gt; ({ default: mod.BillsTab })),
  {
    loading: () =&gt; &lt;div className="animate-pulse bg-gray-200 h-64 rounded"&gt;&lt;/div&gt;,
    ssr: false,
  }
);

const FinanceTab = dynamic(
  () =&gt; import('../tabs/FinanceTab').then(mod =&gt; ({ default: mod.FinanceTab })),
  {
    loading: () =&gt; &lt;div className="animate-pulse bg-gray-200 h-64 rounded"&gt;&lt;/div&gt;,
    ssr: false,
  }
);

interface RepresentativeClientProps {
  representative: EnhancedRepresentative;
  serverData?: {
    bills?: unknown[];
    votes?: unknown[];
    finance?: Record&lt;string, unknown&gt;;
    news?: unknown[];
  };
  partialErrors?: Record&lt;string, string&gt;;
}

export function RepresentativeClient({
  representative,
  serverData,
  partialErrors,
}: RepresentativeClientProps) {
  const [activeTab, setActiveTab] = useState('overview');

  // Calculate stats for the KeyStatsBar
  const calculateStats = () =&gt; {
    const billsCount = Array.isArray(serverData?.bills) ? serverData.bills.length : 0;
    const votesCount = Array.isArray(serverData?.votes) ? serverData.votes.length : 0;
    const committeesCount = representative.committees?.length || 0;

    // Calculate years in office
    const yearsInOffice = representative.terms?.length
      ? new Date().getFullYear() - parseInt(representative.terms[0]?.startYear || '0')
      : 0;

    // Get campaign finance total if available
    const financeData = serverData?.finance as {
      totalRaised?: number;
      totalSpent?: number;
      cashOnHand?: number;
    };

    return {
      billsSponsored: billsCount,
      votesParticipated: votesCount,
      partyAlignment: 85, // Placeholder - would come from actual data
      totalRaised: financeData?.totalRaised || 0,
      yearsInOffice,
      committees: committeesCount,
    };
  };

  const stats = calculateStats();

  const renderTabContent = () =&gt; {
    switch (activeTab) {
      case 'overview':
        return &lt;ContactInfoTab representative={representative} /&gt;;

      case 'voting':
        return (
          &lt;VotingTab
            votes={
              (serverData?.votes as Array&lt;{
                id: string;
                date: string;
                bill?: { number: string; title: string; url?: string };
                question?: string;
                description: string;
                position: 'Yea' | 'Nay' | 'Present' | 'Not Voting';
                result: 'Passed' | 'Failed' | 'Agreed to' | 'Disagreed to';
                chamber: 'House' | 'Senate';
                category?: string;
              }&gt;) || []
            }
          /&gt;
        );

      case 'legislation':
        return (
          &lt;BillsTab
            bills={
              (serverData?.bills as Array&lt;{
                id: string;
                number: string;
                title: string;
                introducedDate: string;
                status: string;
                lastAction: string;
                congress: number;
                type: string;
                policyArea: string;
                url?: string;
                committee?: string;
                progress?: number;
              }&gt;) || []
            }
          /&gt;
        );

      case 'finance':
        return (
          &lt;FinanceTab
            financeData={
              (serverData?.finance as {
                totalRaised: number;
                totalSpent: number;
                cashOnHand: number;
                donations: {
                  individual: number;
                  pac: number;
                  party: number;
                  candidate: number;
                };
                topContributors: Array&lt;{
                  name: string;
                  amount: number;
                  type: 'Individual' | 'PAC' | 'Party Committee';
                }&gt;;
                industryBreakdown: Array&lt;{
                  industry: string;
                  amount: number;
                  percentage: number;
                }&gt;;
                spendingCategories: Array&lt;{
                  category: string;
                  amount: number;
                  percentage: number;
                }&gt;;
              }) || {
                totalRaised: 0,
                totalSpent: 0,
                cashOnHand: 0,
                donations: { individual: 0, pac: 0, party: 0, candidate: 0 },
                topContributors: [],
                industryBreakdown: [],
                spendingCategories: [],
              }
            }
          /&gt;
        );

      case 'committees':
        return (
          &lt;div className="bg-white rounded-lg border border-gray-200 p-6"&gt;
            &lt;h2 className="text-xl font-semibold mb-4"&gt;Committee Information&lt;/h2&gt;
            {representative.committees &amp;&amp; representative.committees.length &gt; 0 ? (
              &lt;div className="space-y-4"&gt;
                {representative.committees.map((committee, index) =&gt; (
                  &lt;div
                    key={index}
                    className="border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-shadow"
                  &gt;
                    &lt;div className="flex justify-between items-start"&gt;
                      &lt;div&gt;
                        &lt;h3 className="font-semibold text-gray-900"&gt;{committee.name}&lt;/h3&gt;
                        {committee.role &amp;&amp; (
                          &lt;span className="inline-block mt-2 px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full"&gt;
                            {committee.role}
                          &lt;/span&gt;
                        )}
                      &lt;/div&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                ))}
              &lt;/div&gt;
            ) : (
              &lt;p className="text-gray-500"&gt;No committee information available.&lt;/p&gt;
            )}
          &lt;/div&gt;
        );

      case 'news':
        return (
          &lt;div className="bg-white rounded-lg border border-gray-200 p-6"&gt;
            &lt;h2 className="text-xl font-semibold mb-4"&gt;Recent News&lt;/h2&gt;
            &lt;p className="text-gray-500"&gt;News integration coming soon...&lt;/p&gt;
          &lt;/div&gt;
        );

      default:
        return &lt;ProfileOverview representative={representative} /&gt;;
    }
  };

  return (
    &lt;div className="min-h-screen bg-gray-50"&gt;
      {/* Enhanced Header */}
      &lt;EnhancedHeader representative={representative} /&gt;

      {/* Key Stats Bar */}
      &lt;KeyStatsBar stats={stats} /&gt;

      {/* Main Content Area */}
      &lt;div className="container mx-auto px-4 py-6"&gt;
        {/* Error Display for Partial Failures */}
        {partialErrors &amp;&amp; Object.keys(partialErrors).length &gt; 0 &amp;&amp; (
          &lt;div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6"&gt;
            &lt;div className="flex"&gt;
              &lt;div className="flex-shrink-0"&gt;
                &lt;svg className="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"&gt;
                  &lt;path
                    fillRule="evenodd"
                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                    clipRule="evenodd"
                  /&gt;
                &lt;/svg&gt;
              &lt;/div&gt;
              &lt;div className="ml-3"&gt;
                &lt;h3 className="text-sm font-medium text-yellow-800"&gt;
                  Some data could not be loaded
                &lt;/h3&gt;
                &lt;div className="mt-2 text-sm text-yellow-700"&gt;
                  &lt;p&gt;The following information may be incomplete:&lt;/p&gt;
                  &lt;ul className="list-disc list-inside mt-1"&gt;
                    {Object.entries(partialErrors).map(([key, error]) =&gt; (
                      &lt;li key={key} className="capitalize"&gt;
                        {key.replace('-', ' ')}:{' '}
                        {typeof error === 'string' ? error : 'Failed to load'}
                      &lt;/li&gt;
                    ))}
                  &lt;/ul&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        )}

        {/* Main Layout Grid */}
        &lt;div className="lg:grid lg:grid-cols-4 lg:gap-6"&gt;
          {/* Main Content */}
          &lt;div className="lg:col-span-3"&gt;
            {/* Tab Navigation */}
            &lt;div className="mb-6"&gt;
              &lt;TabNavigation
                activeTab={activeTab}
                onTabChange={setActiveTab}
                tabs={profileTabs}
                size="md"
              /&gt;
            &lt;/div&gt;

            {/* Tab Content */}
            &lt;div className="min-h-96"&gt;{renderTabContent()}&lt;/div&gt;
          &lt;/div&gt;

          {/* Sidebar */}
          &lt;div className="lg:col-span-1 mt-6 lg:mt-0"&gt;
            &lt;DistrictSidebar representative={representative} /&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        {/* Data Transparency */}
        &lt;div className="mt-8"&gt;
          &lt;DataTransparencyPanel
            metadata={{
              source: 'congress-legislators + congress.gov',
              cached: true,
              fetchedAt: new Date().toISOString(),
              dataQuality: 'high',
              freshness: 'Current',
            }}
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

</file>
<file path="src/lib/api/representatives.ts">
/**
 * Copyright (c) 2019-2025 Mark Sandford
 * Licensed under the MIT License. See LICENSE and NOTICE files.
 */

import { cache } from '@/lib/cache';
import { RepresentativeProfile, BatchApiResponse } from '@/types/representative';

// Base API configuration - FIXED to work with Next.js API routes
const getApiBaseUrl = () =&gt; {
  // For client-side requests
  if (typeof window !== 'undefined') {
    // Use relative URLs for same-origin requests (your API routes)
    // This ensures requests go to /api/... on the same domain
    return '';
  }
  // For server-side requests (if needed)
  return process.env.NEXT_PUBLIC_API_URL || '';
};

const DEFAULT_TIMEOUT = 30000; // 30 seconds for batch requests

// Error types for better error handling
export class RepresentativeApiError extends Error {
  constructor(
    message: string,
    public statusCode: number,
    public endpoint?: string,
    public originalError?: Error
  ) {
    super(message);
    this.name = 'RepresentativeApiError';
  }
}

// Next.js 15 optimized fetch wrapper with built-in caching and deduplication
async function apiRequest&lt;T&gt;(
  endpoint: string,
  options: RequestInit &amp; {
    cacheTime?: number;
    tags?: string[];
    revalidate?: number | false;
  } = {}
): Promise&lt;T&gt; {
  const { cacheTime = 300, tags = [], revalidate, ...fetchOptions } = options;

  // FIXED: Ensure endpoint starts with / for relative URLs
  const normalizedEndpoint = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;
  const baseUrl = getApiBaseUrl();
  const url = `${baseUrl}${normalizedEndpoint}`;

  console.log(`[CIV.IQ-DEBUG] API Request: ${fetchOptions.method || 'GET'} ${url}`);
  console.log(`[CIV.IQ-DEBUG] Base URL: "${baseUrl}", Endpoint: "${normalizedEndpoint}"`);

  try {
    // Create AbortController for timeout
    const controller = new AbortController();
    const timeoutId = setTimeout(() =&gt; controller.abort(), DEFAULT_TIMEOUT);

    const response = await fetch(url, {
      ...fetchOptions,
      headers: {
        'Content-Type': 'application/json',
        ...fetchOptions.headers,
      },
      signal: controller.signal,
      // Next.js 15 caching with automatic deduplication
      ...(revalidate !== undefined
        ? {
            next: {
              revalidate: revalidate !== false ? revalidate : cacheTime,
              tags: [...tags, `api-${endpoint.split('/').join('-')}`],
            },
          }
        : {}),
    });

    clearTimeout(timeoutId);

    console.log(`[CIV.IQ-DEBUG] API Response: ${response.status} ${response.statusText}`);

    if (!response.ok) {
      const errorText = await response.text().catch(() =&gt; 'No error details');
      console.error(`[CIV.IQ-DEBUG] API Error Response:`, errorText);

      throw new RepresentativeApiError(
        `API request failed: ${response.status} ${response.statusText}`,
        response.status,
        endpoint,
        new Error(errorText)
      );
    }

    const data = await response.json();
    console.log(`[CIV.IQ-DEBUG] API Success Response:`, {
      endpoint,
      hasData: !!data,
      dataKeys: data ? Object.keys(data).slice(0, 5) : [],
    });

    return data;
  } catch (error) {
    console.error(`[CIV.IQ-DEBUG] API Request Error:`, {
      endpoint,
      error: error instanceof Error ? error.message : String(error),
      errorType: error instanceof Error ? error.constructor.name : typeof error,
    });

    if (error instanceof RepresentativeApiError) {
      throw error;
    }

    // Handle abort/timeout errors
    if (error instanceof Error &amp;&amp; error.name === 'AbortError') {
      throw new RepresentativeApiError('Request timeout - please try again', 408, endpoint, error);
    }

    throw new RepresentativeApiError(
      `Network error: ${error instanceof Error ? error.message : 'Unknown error'}`,
      500,
      endpoint,
      error instanceof Error ? error : new Error(String(error))
    );
  }
}

// Representative API client
export const representativeApi = {
  /**
   * Get representative profile using batch API for optimal performance
   */
  async getProfileBatch(
    bioguideId: string,
    options: {
      includeVotes?: boolean;
      includeBills?: boolean;
      includeFinance?: boolean;
      includeNews?: boolean;
      includePartyAlignment?: boolean;
      includeCommittees?: boolean;
      includeLeadership?: boolean;
      includeDistrict?: boolean;
    } = {}
  ): Promise&lt;BatchApiResponse&gt; {
    // Build endpoint list based on options
    const endpoints: string[] = ['profile']; // Always include basic profile

    if (options.includeVotes) endpoints.push('votes');
    if (options.includeBills) endpoints.push('bills');
    if (options.includeFinance) endpoints.push('finance');
    if (options.includeNews) endpoints.push('news');
    if (options.includePartyAlignment) endpoints.push('party-alignment');
    if (options.includeCommittees) endpoints.push('committees');
    if (options.includeLeadership) endpoints.push('leadership');
    if (options.includeDistrict) endpoints.push('district');

    console.log(`[CIV.IQ-DEBUG] Batch request for ${bioguideId} with endpoints:`, endpoints);

    try {
      const response = await apiRequest&lt;BatchApiResponse&gt;(
        `/api/representative/${bioguideId}/batch`,
        {
          method: 'POST',
          body: JSON.stringify({ endpoints }),
        }
      );

      console.log(`[CIV.IQ-DEBUG] Batch response processed successfully:`, {
        bioguideId,
        endpointsRequested: endpoints.length,
        successfulEndpoints: Object.keys(response.data || {}).length,
        hasErrors: response.errors &amp;&amp; Object.keys(response.errors).length &gt; 0,
        executionTime: response.executionTime,
      });

      return response;
    } catch (error) {
      console.error(`[CIV.IQ-DEBUG] Batch API failed, falling back to individual calls`, error);
      // Return empty batch response on error
      return {
        success: false,
        data: {},
        errors: {
          batch: error instanceof Error ? error.message : 'Batch API failed',
        },
        metadata: {
          timestamp: new Date().toISOString(),
          requestedEndpoints: endpoints,
          successfulEndpoints: [],
          failedEndpoints: endpoints,
          totalTime: 0,
        },
        executionTime: 0,
      };
    }
  },

  /**
   * Get individual representative profile (fallback method)
   */
  async getProfile(bioguideId: string): Promise&lt;RepresentativeProfile&gt; {
    return apiRequest&lt;RepresentativeProfile&gt;(`/api/representative/${bioguideId}`, {
      cacheTime: 600, // 10 minutes - profile data changes infrequently
      tags: [`representative-${bioguideId}`, 'representative-profile'],
    });
  },

  /**
   * Get representative votes - client-side with shorter cache for real-time updates
   */
  async getVotes(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/votes`, {
      cacheTime: 300, // 5 minutes - voting data updates frequently
      tags: [`representative-${bioguideId}`, 'representative-votes'],
    });
  },

  /**
   * Get representative bills
   */
  async getBills(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/bills`, {
      cacheTime: 600, // 10 minutes - bill data changes moderately
      tags: [`representative-${bioguideId}`, 'representative-bills'],
    });
  },

  /**
   * Get representative finance data
   */
  async getFinance(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/finance`, {
      cacheTime: 1800, // 30 minutes - finance data changes less frequently
      tags: [`representative-${bioguideId}`, 'representative-finance'],
    });
  },

  /**
   * Get representative news - short cache for real-time updates
   */
  async getNews(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/news`, {
      cacheTime: 180, // 3 minutes - news updates frequently
      tags: [`representative-${bioguideId}`, 'representative-news'],
    });
  },

  /**
   * Get party alignment analysis
   */
  async getPartyAlignment(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/party-alignment`, {
      cacheTime: 1800, // 30 minutes - alignment data changes slowly
      tags: [`representative-${bioguideId}`, 'representative-party-alignment'],
    });
  },

  /**
   * Get committee assignments
   */
  async getCommittees(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/committees`, {
      cacheTime: 3600, // 1 hour - committee assignments change infrequently
      tags: [`representative-${bioguideId}`, 'representative-committees'],
    });
  },

  /**
   * Get leadership positions
   */
  async getLeadership(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/leadership`, {
      cacheTime: 3600, // 1 hour - leadership positions change infrequently
      tags: [`representative-${bioguideId}`, 'representative-leadership'],
    });
  },

  /**
   * Get district information
   */
  async getDistrict(bioguideId: string): Promise&lt;any&gt; {
    return apiRequest(`/api/representative/${bioguideId}/district`, {
      cacheTime: 3600, // 1 hour - district info changes rarely
      tags: [`representative-${bioguideId}`, 'representative-district'],
    });
  },

  /**
   * Search representatives - with deduplication for common searches
   */
  async search(params: {
    zip?: string;
    state?: string;
    district?: string;
    party?: string;
    chamber?: string;
    query?: string;
  }): Promise&lt;RepresentativeProfile[]&gt; {
    const searchParams = new URLSearchParams();

    Object.entries(params).forEach(([key, value]) =&gt; {
      if (value) searchParams.append(key, value);
    });

    const queryString = searchParams.toString();
    return apiRequest&lt;RepresentativeProfile[]&gt;(
      `/api/representatives${queryString ? `?${queryString}` : ''}`,
      {
        cacheTime: 300, // 5 minutes for search results
        tags: ['representatives-search', `search-${queryString}`],
      }
    );
  },

  /**
   * Get representatives by ZIP code - highly cached due to frequent access
   */
  async getByZip(zipCode: string): Promise&lt;RepresentativeProfile[]&gt; {
    return apiRequest&lt;RepresentativeProfile[]&gt;(`/api/representatives?zip=${zipCode}`, {
      cacheTime: 600, // 10 minutes - ZIP lookups are expensive
      tags: ['representatives-zip', `zip-${zipCode}`],
    });
  },
};

// RepresentativeApiError is already exported above with the class declaration
export type { BatchApiResponse };

</file>
<file path="src/types/representative.ts">
/**
 * Copyright (c) 2019-2025 Mark Sandford
 * Licensed under the MIT License. See LICENSE and NOTICE files.
 */

/**
 * Enhanced Representative Types
 *
 * This file defines comprehensive types for representative data,
 * combining our existing structure with congress-legislators enhancements.
 * Includes error handling and batch API response types.
 */

// Base representative interface (existing structure)
export interface BaseRepresentative {
  bioguideId: string;
  name: string;
  firstName: string;
  lastName: string;
  party: string;
  state: string;
  district?: string;
  chamber: 'House' | 'Senate';
  title: string;
  phone?: string;
  email?: string;
  website?: string;
  imageUrl?: string;
  terms: Array&lt;{
    congress: string;
    startYear: string;
    endYear: string;
  }&gt;;
  committees?: Array&lt;{
    name: string;
    role?: string;
  }&gt;;
}

// Enhanced representative with congress-legislators data
export interface EnhancedRepresentative extends BaseRepresentative {
  // Enhanced name information
  fullName?: {
    first: string;
    middle?: string;
    last: string;
    suffix?: string;
    nickname?: string;
    official?: string;
  };

  // Biographical information
  bio?: {
    birthday?: string;
    gender?: 'M' | 'F';
    religion?: string;
  };

  // Current term details
  currentTerm?: {
    start: string;
    end: string;
    office?: string;
    phone?: string;
    address?: string;
    website?: string;
    contactForm?: string;
    rssUrl?: string;
    stateRank?: 'junior' | 'senior';
    class?: number; // Senate class
  };

  // Social media presence
  socialMedia?: {
    twitter?: string;
    facebook?: string;
    youtube?: string;
    instagram?: string;
    mastodon?: string;
  };

  // Cross-platform IDs
  ids?: {
    govtrack?: number;
    opensecrets?: string;
    votesmart?: number;
    fec?: string[];
    cspan?: number;
    wikipedia?: string;
    wikidata?: string;
    ballotpedia?: string;
  };

  // Leadership roles
  leadershipRoles?: Array&lt;{
    title: string;
    start: string;
    end?: string;
  }&gt;;

  // Enhanced contact information
  contact?: {
    dcOffice?: {
      address?: string;
      phone?: string;
      fax?: string;
      hours?: string;
    };
    districtOffices?: Array&lt;{
      address: string;
      phone?: string;
      fax?: string;
      hours?: string;
    }&gt;;
    contactForm?: string;
    schedulingUrl?: string;
  };

  // Data source metadata
  metadata?: {
    lastUpdated: string;
    dataSources: Array&lt;'congress.gov' | 'congress-legislators' | 'fec' | 'openstates'&gt;;
    completeness?: {
      basicInfo: boolean;
      socialMedia: boolean;
      contact: boolean;
      committees: boolean;
      finance: boolean;
    };
  };
}

// Representative summary for list views
export interface RepresentativeSummary {
  bioguideId: string;
  name: string;
  party: string;
  state: string;
  district?: string;
  chamber: 'House' | 'Senate';
  title: string;
  imageUrl?: string;
  website?: string;
  phone?: string;
}

// Representative search result
export interface RepresentativeSearchResult extends RepresentativeSummary {
  relevanceScore?: number;
  matchedFields?: string[];
}

// Committee information
export interface CommitteeMembership {
  committeeId: string;
  name: string;
  fullName: string;
  role: 'Chair' | 'Vice Chair' | 'Ranking Member' | 'Member';
  subcommittees?: Array&lt;{
    name: string;
    role: string;
  }&gt;;
  startDate?: string;
  endDate?: string;
}

// Enhanced committee data
export interface EnhancedCommitteeInfo {
  current: CommitteeMembership[];
  historical: CommitteeMembership[];
  leadership: Array&lt;{
    committee: string;
    role: string;
    startDate: string;
    endDate?: string;
  }&gt;;
}

// Representative analytics data
export interface RepresentativeAnalytics {
  effectiveness?: {
    billsSponsored: number;
    billsPassed: number;
    amendmentsOffered: number;
    successRate: number;
  };
  engagement?: {
    townHalls: number;
    pressReleases: number;
    socialMediaActivity: number;
    lastUpdate: string;
  };
  voting?: {
    totalVotes: number;
    partyLineVotes: number;
    bipartisanVotes: number;
    absences: number;
    votingScore: number;
  };
}

// Contact attempt tracking
export interface ContactAttempt {
  id: string;
  bioguideId: string;
  userId?: string;
  method: 'email' | 'phone' | 'contact_form' | 'office_visit';
  timestamp: string;
  subject?: string;
  status: 'sent' | 'delivered' | 'responded' | 'failed';
  response?: {
    receivedAt: string;
    type: 'automated' | 'personal';
    content?: string;
  };
}

// ZIP code to representative mapping
export interface ZipCodeRepresentatives {
  zipCode: string;
  state: string;
  representatives: {
    house?: RepresentativeSummary;
    senate: RepresentativeSummary[];
  };
  district?: string;
  lastUpdated: string;
}

// Type guards
export function isEnhancedRepresentative(rep: unknown): rep is EnhancedRepresentative {
  return (
    typeof rep === 'object' &amp;&amp;
    rep !== null &amp;&amp;
    'bioguideId' in rep &amp;&amp;
    'name' in rep &amp;&amp;
    typeof (rep as Record&lt;string, unknown&gt;).bioguideId === 'string' &amp;&amp;
    typeof (rep as Record&lt;string, unknown&gt;).name === 'string'
  );
}

export function isRepresentativeSummary(rep: unknown): rep is RepresentativeSummary {
  return (
    typeof rep === 'object' &amp;&amp;
    rep !== null &amp;&amp;
    'bioguideId' in rep &amp;&amp;
    'name' in rep &amp;&amp;
    'party' in rep &amp;&amp;
    typeof (rep as Record&lt;string, unknown&gt;).bioguideId === 'string' &amp;&amp;
    typeof (rep as Record&lt;string, unknown&gt;).name === 'string' &amp;&amp;
    typeof (rep as Record&lt;string, unknown&gt;).party === 'string'
  );
}

// Utility types
export type RepresentativeField = keyof EnhancedRepresentative;
export type SocialMediaPlatform = keyof NonNullable&lt;EnhancedRepresentative['socialMedia']&gt;;
export type RepresentativeId = keyof NonNullable&lt;EnhancedRepresentative['ids']&gt;;

// API response types
export interface RepresentativeApiResponse {
  representative: EnhancedRepresentative;
  success: boolean;
  error?: string;
  metadata?: {
    cacheHit?: boolean;
    responseTime?: number;
    dataSource?: string;
  };
}

export interface RepresentativesListResponse {
  representatives: RepresentativeSummary[];
  total: number;
  page?: number;
  perPage?: number;
  hasMore?: boolean;
  success: boolean;
  error?: string;
}

// Filter and search options
export interface RepresentativeFilters {
  state?: string;
  party?: string;
  chamber?: 'House' | 'Senate';
  committee?: string;
  leadership?: boolean;
  hasTwitter?: boolean;
  hasFacebook?: boolean;
  hasWebsite?: boolean;
}

export interface RepresentativeSearchOptions {
  query?: string;
  filters?: RepresentativeFilters;
  sortBy?: 'name' | 'state' | 'party' | 'seniority';
  sortOrder?: 'asc' | 'desc';
  limit?: number;
  offset?: number;
}

// Enhanced error handling types
export interface APIError {
  message: string;
  statusCode: number;
  endpoint?: string;
  timestamp: string;
  requestId?: string;
}

// Specific data types for batch responses
export interface VoteData {
  vote_id: string;
  position: string;
  date: string;
  bill: {
    title: string;
    number: string;
  };
}

export interface BillData {
  bill_id: string;
  title: string;
  number: string;
  congress: number;
  introduced_date: string;
  status: string;
}

export interface FinanceData {
  total_receipts?: number;
  total_disbursements?: number;
  cash_on_hand?: number;
  cycle: string;
}

export interface NewsData {
  title: string;
  url: string;
  published_date: string;
  source: string;
}

// Batch API response types
export interface BatchApiResponse {
  success: boolean;
  data: {
    votes?: VoteData[];
    bills?: BillData[];
    finance?: FinanceData;
    news?: NewsData[];
    profile?: EnhancedRepresentative;
    [key: string]: unknown;
  };
  errors: Record&lt;string, string&gt;;
  metadata: {
    timestamp: string;
    requestedEndpoints: string[];
    successfulEndpoints: string[];
    failedEndpoints: string[];
    totalTime: number;
  };
  executionTime: number;
}

// Enhanced type for batch API hook
export interface BatchApiHookResult {
  data: {
    votes?: VoteData[];
    bills?: BillData[];
    finance?: FinanceData;
    news?: NewsData[];
    profile?: EnhancedRepresentative;
    [key: string]: unknown;
  };
  loading: boolean;
  error: string | null;
  refetch: () =&gt; Promise&lt;void&gt;;
  metadata?: BatchApiResponse['metadata'];
  partialErrors?: Record&lt;string, string&gt;;
}

// Profile data structure for batch response
export interface RepresentativeProfile {
  profile: EnhancedRepresentative;
  votes?: VoteData[];
  bills?: BillData[];
  finance?: FinanceData;
  news?: NewsData[];
  'party-alignment'?: {
    score: number;
    total_votes: number;
    party_line_votes: number;
  };
  committees?: CommitteeMembership[];
  leadership?: {
    positions: string[];
    current_role?: string;
  };
  district?: {
    id: string;
    state: string;
    number: string;
  };
}

// Individual endpoint response wrapper
export interface EndpointResponse&lt;T = unknown&gt; {
  success: boolean;
  data?: T;
  error?: string;
  cached?: boolean;
  executionTime?: number;
}

</file>
</debug-context>